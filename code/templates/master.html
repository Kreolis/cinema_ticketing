<!DOCTYPE html>
{% load django_bootstrap5 %}
{% bootstrap_css %}
{% bootstrap_javascript %}
{% load branding_tags %}
{% load i18n %}

{% get_current_language as CURRENT_LANGUAGE %}
{% get_available_languages as AVAILABLE_LANGUAGES %}
{% get_language_info_list for AVAILABLE_LANGUAGES as languages %}

{% get_active_favicon as active_favicon %}
{% get_active_logo as active_logo %}
{% get_active_site_name as active_site_name %}

<html lang="{{ CURRENT_LANGUAGE }}">
  
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  {% if active_favicon %}
    <link rel="icon" href="{{ active_favicon }}" type="image/x-icon">
  {% else %}
    <link rel="icon" href="" type="image/x-icon">
  {% endif %}
    <title>{% block title %}{% endblock %}</title>
</head>
<body>

<div class="container">
  <nav class="nav bg-info justify-content-between align-items-center position-sticky top-0" style="z-index: 1030;">
    <div class="d-flex align-items-center">
      <li class="nav-item">
        <a class="nav-link link-light d-flex align-items-center gap-2 fw-semibold py-2" href="{% url 'event_list' %}">
          {% if active_logo %}
            <img src="{{ active_logo }}" alt="Home" style="height: 28px; width: auto;">
          {% endif %}
          <span class="lh-1">
            {% if active_site_name %}
              {{ active_site_name }}
            {% else %}
              {% translate "Home" %}
            {% endif %}
          </span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link link-light d-flex align-items-center py-2" href="{% url 'event_list' %}">{% translate "Events List" %}</a>
      </li>
      {% if user.is_authenticated and user.is_staff %}
        <li class="nav-item">
          <a class="nav-link link-light d-flex align-items-center py-2" href="{% url 'all_events_statistics' %}">{% translate "Global Statistics" %}</a>
        </li>
        <li class="nav-item">
          <a class="nav-link link-light d-flex align-items-center py-2" href="{% url 'manage_orders' %}">{% translate "Manage Orders" %}</a>
        </li>
        <li class="nav-item">
          <a class="nav-link link-light d-flex align-items-center py-2" href="{% url 'admin:index' %}">{% translate "Display Backend" %}</a>
        </li>
        <li class="nav-item">
          <a class="nav-link link-light d-flex align-items-center py-2" href="/rosetta">{% translate "Translations" %}</a>
        </li>
      {% else %}
        <li class="nav-item">
          <a class="nav-link link-light d-flex align-items-center py-2" href="{% url 'cart_view' %}">
            {% translate "Cart" %}
            {% if cart_ticket_count > 0 %}
              <span class="badge bg-warning text-dark">{{ cart_ticket_count }}</span>
            {% endif %}
          </a>
        </li>
      {% endif %}
    </div>

    <div class="d-flex align-items-center">
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle link-light d-flex align-items-center py-2" href="#" id="languageDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
          {% translate "Language" %}
        </a>
        <ul class="dropdown-menu" aria-labelledby="languageDropdown">
          {% for language in languages %}
            <li>
              <a class="dropdown-item{% if language.code == CURRENT_LANGUAGE %} active{% endif %}" href="#" onclick="changeLanguage('{{ language.code }}'); return false;">
                {{ language.name_local }}
              </a>
            </li>
          {% endfor %}
        </ul>
      </li>
      <li class="nav-item">
        {% if user.is_authenticated %}
          <a class="nav-link link-light d-flex align-items-center py-2" href="{% url 'logout' %}">{% translate "Logout" %}</a>
        {% else %}
          <a class="nav-link link-light d-flex align-items-center py-2" href="{% url 'login' %}">{% translate "Login" %}</a>
        {% endif %}
      </li>
    </div>
  </nav>

  {% block content %}
  {% endblock %}
</div>
</body>

<footer class="mt-auto py-3">
  <div class="container d-flex justify-content-center">
    <p class="mx-2 mb-0">Cinema Ticketing System Â© 2025</p>
    <p class="mx-2 mb-0"><a href="{% url 'contact_form' %}">{% translate "Contact Us" %}</a></p>
  </div>
</footer>

<script>
function changeLanguage(languageCode) {
  const currentPath = window.location.pathname;
  const pathSegments = currentPath.split('/').filter(segment => segment);
  
  // If the first segment is a language code, replace it
  if (pathSegments.length > 0 && pathSegments[0].length === 2) {
    pathSegments[0] = languageCode;
  } else {
    // Otherwise, prepend the language code
    pathSegments.unshift(languageCode);
  }
  
  const newPath = '/' + pathSegments.join('/') + (currentPath.endsWith('/') ? '/' : '');
  window.location.href = newPath;
}
</script>

</html>